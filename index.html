<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Teste Auditivo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="apple-touch-icon" href="icon.png">

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#f2f2f7;
}

.container{
  min-height:100vh;
  display:flex;
  justify-content:flex-start;
}

.content{
  width:100%;
  text-align:center;
  padding:40px 30px 30px;
}

.screen{display:none}
.screen.active{display:block}

h1{
  font-size:36px;
  margin-bottom:25px;
}

p{
  font-size:26px;
  margin-bottom:35px;
}

button{
  border:none;
  border-radius:16px;
  color:#fff;
  margin:14px;
  cursor:pointer;
}

.play{
  background:#000;
  font-size:26px;
  padding:26px 50px;
  min-width:280px;
}

.play.playing{
  background:#444;
}

.yes{
  background:#34c759;
  font-size:22px;
  padding:18px 36px;
}

.no{
  background:#ff3b30;
  font-size:22px;
  padding:18px 36px;
}

.statBtn{
  background:#007aff;
  font-size:22px;
  padding:18px 36px;
  margin-top:20px;
}

.resetBtn{
  background:#ff9500;
  font-size:22px;
  padding:18px 36px;
  margin-top:10px;
}
</style>
</head>

<body>
<div class="container">
<div class="content">

<!-- Ecr√£ 1 -->
<div class="screen active" id="s1">
  <h1>Teste Auditivo</h1>
  <p>Vamos fazer um simples teste auditivo.</p>
  <button class="play" onclick="startTest()">Come√ßar</button>
</div>

<!-- Ecr√£ 2 -->
<div class="screen" id="s2">
  <p>Ou√ßa com aten√ß√£o e carregue no bot√£o para ouvir.</p>
  <button class="play" onclick="playSound(this,'a1')">Ouvir som #1</button><br>
  <button class="yes" onclick="next(3)">Ouvi</button>
  <button class="no" onclick="failSound(); next(3)">N√£o ouvi</button>
</div>

<!-- Ecr√£ 3 -->
<div class="screen" id="s3">
  <p>Ou√ßa com aten√ß√£o e carregue no bot√£o para ouvir.</p>
  <button class="play" onclick="playSound(this,'a4')">Ouvir som #2</button><br>
  <button class="yes" onclick="next(4)">Ouvi</button>
  <button class="no" onclick="failSound(); next(4)">N√£o ouvi</button>
</div>

<!-- Ecr√£ 4 -->
<div class="screen" id="s4">
  <p>Ou√ßa com aten√ß√£o e carregue no bot√£o para ouvir.</p>
  <button class="play" onclick="playSound(this,'a8')">Ouvir som #3</button><br>
  <button class="yes" onclick="finish()">Ouvi</button>
  <button class="no" onclick="failSound(); finish()">N√£o ouvi</button>
</div>

<!-- Ecr√£ final -->
<div class="screen" id="s5">
  <h1>Resultado</h1>
  <p>
    Se n√£o ouviu os 3 sons,<br>
    <strong>marque j√° uma consulta gratuita.</strong>
  </p>
  <button class="statBtn" onclick="showStats()">Ver Estat√≠sticas</button>
</div>

<!-- Estat√≠sticas -->
<div class="screen" id="stats">
  <h1>Estat√≠sticas</h1>
  <p>Total de testes: <span id="totalDisplay">0</span></p>
  <p>N√£o passaram: <span id="failedDisplay">0</span></p>
  <button class="statBtn" onclick="showStats()">Atualizar</button><br>
  <button class="resetBtn" onclick="resetStats()">Resetar contadores</button><br>
  <button class="statBtn" onclick="next(1)">Voltar ao in√≠cio</button>
</div>

<audio id="a1" src="1kHz.mp3"></audio>
<audio id="a4" src="4kHz.mp3"></audio>
<audio id="a8" src="8kHz.mp3"></audio>

</div>
</div>

<script>
let failed = false;

function startTest(){
  incrementStat("totalTests");
  failed = false;
  next(2);
}

function next(n){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('s'+n).classList.add('active');
}

function finish(){
  if(failed){
    incrementStat("failedTests");
  }
  next(5);
}

function failSound(){
  failed = true;
}

function playSound(button, audioId){
  const audio = document.getElementById(audioId);

  button.classList.add('playing');
  const originalText = button.innerHTML;
  button.innerHTML = "üîä A reproduzir...";
  button.disabled = true;

  audio.currentTime = 0;
  audio.play();

  audio.onended = () => {
    button.classList.remove('playing');
    button.innerHTML = originalText;
    button.disabled = false;
  };
}

/* Estat√≠sticas locais */
function incrementStat(key){
  let value = localStorage.getItem(key);
  value = value ? parseInt(value) : 0;
  localStorage.setItem(key, value + 1);
}

function showStats(){
  document.getElementById('totalDisplay').innerText = localStorage.getItem('totalTests') || 0;
  document.getElementById('failedDisplay').innerText = localStorage.getItem('failedTests') || 0;
  next('stats');
}

function resetStats(){
  localStorage.setItem('totalTests',0);
  localStorage.setItem('failedTests',0);
  showStats();
}
</script>

</body>
</html>
